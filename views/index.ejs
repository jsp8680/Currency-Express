<!DOCTYPE html>
<html>
  <head>
    <title>Currency Converter</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <header><%- include('partials/header.ejs') %></header>

  <body>
    <h2>Currency Express</h2>
    <div>
      <h3>Amount</h3>
      <input id="amount" type="number" />
    </div>

    <div>
      <h4>From</h4>

      <select class="currency-select" id="currencyFrom">
        <option value="CAD">CAD - Canadian Dollar</option>
        <option value="USD">USD - United States Dollar</option>
        <option value="EUR">EUR - European Dollar</option>
      </select>
    </div>
    <span id="arrows"> â‡† </span>

    <div>
      <h5>To</h5>
      <select class="currency-select" id="currencyTo">
        <option value="CAD">CAD - Canadian Dollar</option>
        <option value="USD">USD - United States Dollar</option>
        <option value="EUR">EUR - European Dollar</option>
      </select>
    </div>

    <div>
      <button id="convertButton">Convert</button>
    </div>

    <div>
      <input id="previous" type="text" />
    </div>
    <span id="equals"> = </span>

    <div>
      <input id="prior" type="text" />
    </div>

    <div id="result"></div>

    <button class="btn help">Need Help?</button>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Get references to the DOM elements
        const convertButton = document.getElementById("convertButton");
        const amountInput = document.getElementById("amount");
        const fromSelect = document.getElementById("currencyFrom");
        const toSelect = document.getElementById("currencyTo");
        const previousInput = document.getElementById("previous");
        const priorInput = document.getElementById("prior");
        const resultDiv = document.getElementById("result");

        // Attach a click event listener to the Convert button
        convertButton.addEventListener("click", async () => {
          const fromCurrency = fromSelect.value;
          const toCurrency = toSelect.value;
          const amount = parseFloat(amountInput.value); // Parse the amount to a number

          try {
            // Fetch the exchange rate data from API
            const response = await fetch(
              `https://v6.exchangerate-api.com/v6/52a3c3c7704171311bbfd9a6/latest/${fromCurrency}`
            );
            if (!response.ok) {
              throw new Error("Failed to fetch exchange rate data");
            }

            const data = await response.json();
            const rate = data.conversion_rates[toCurrency];
            if (!rate) {
              throw new Error("Invalid target currency");
            }

            // Calculate the converted amount
            const convertedAmount = (amount * rate).toFixed(2);

            // Update the input fields with conversion results
            previousInput.value = fromCurrency + " " + amount.toFixed(2);
            priorInput.value = toCurrency + " " + convertedAmount;
          } catch (error) {
            // Handle errors and display a message
            resultDiv.textContent = "An error occurred during conversion.";
            console.error(error);
          }
        });
      });
    </script>
  </body>
</html>
